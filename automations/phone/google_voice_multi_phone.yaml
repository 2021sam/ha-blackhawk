- id: '1767307551834'
  alias: Deercreek - TTS â€“ Speak Google Voice last notification (Multi-phone)
  description: >
    Speak Google Voice notifications via TTS on amp_1.

    Phones:
    - Blackhawk: sensor.lm_q710_fgn_last_notification
    - Deercreek: sensor.sm_g965u_last_notification
  triggers:
    - entity_id: sensor.sm_g965u_last_notification
      trigger: state
  conditions:
    - condition: template
      value_template: >
        {{ state_attr(n,'package') == 'com.google.android.apps.googlevoice' }}
    - condition: template
      value_template: >
        {{
          (state_attr(n,'android.title') or '') | length > 0
          or
          (state_attr(n,'android.text') or '') | length > 0
        }}
    - condition: template
      value_template: >
        {{
          (state_attr(n,'post_time') | string)
          !=
          states('input_text.last_google_voice_post_time_spoken')
        }}
  actions:
    - variables:
        who: "{{ state_attr(n,'android.title') or 'Message' }}"
        txt: "{{ state_attr(n,'android.text') or '' }}"
        msg: "{{ who ~ ': ' ~ txt if txt|length > 0 else who ~ ': (no text)' }}"
        pt: "{{ state_attr(n,'post_time') or now().timestamp() | int }}"
    - target:
        entity_id: tts.google_translate_en_com
      data:
        media_player_entity_id: media_player.amp_1
        message: "{{ msg }}"
      action: tts.speak
    - target:
        entity_id: input_text.last_google_voice_post_time_spoken
      data:
        value: "{{ pt }}"
      action: input_text.set_value
  mode: single
  variables:
    phones:
      blackhawk: sensor.lm_q710_fgn_last_notification
      deercreek: sensor.sm_g965u_last_notification
    phone: "{{ phones.deercreek }}"
    n: "{{ phone }}"
